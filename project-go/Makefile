BINARY=project
SRC=main.go commands.go io.go slist.go dlist.go stack.go queue.go help.go hashtable.go serialize.go

all: build

build:
	@echo "Building..."
	@go build -o $(BINARY) $(SRC)
	@echo "Build complete: $(BINARY)"

run: build
	@echo "Running..."
	@./$(BINARY)

test:
	@echo "Running tests..."
	@go test -v ./...

coverage:
	@echo "ðŸ“Š Generating coverage report..."
	@go test -coverprofile=coverage.out ./...
	@go tool cover -html=coverage.out -o coverage.html
	@echo "âœ… HTML Ð¾Ñ‚Ñ‡ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½: coverage.html"

bench:
	@echo "âš¡ Running benchmarks only..."
	@go test -bench=. -benchmem -benchtime=2s -run="^$$" ./...

lint:
	@echo "ðŸ” Running go vet..."
	@go vet ./...
	@echo "ðŸ” Checking format..."
	@if [ -n "$$(gofmt -l .)" ]; then \
		echo "âŒ Code is not formatted. Run 'make lint-fix'"; \
		exit 1; \
	fi
	@echo "âœ… All lint checks passed!"

lint-fix:
	@echo "ðŸ”§ Fixing formatting..."
	@gofmt -w .
	@echo "âœ… Formatting fixed!"

# UML Generation
uml-standalone:
	@echo "ðŸ“Š Generating standalone UML..."
	@go run tools/uml_standalone.go
	@echo "âœ… Open uml_standalone.html in your browser"

uml: uml-standalone
	@echo "ðŸŒ Opening standalone UML..."
	@xdg-open uml_standalone.html 2>/dev/null || open uml_standalone.html 2>/dev/null || echo "âœ… Open uml_standalone.html manually"

clean:
	@echo "ðŸ§¹ Cleaning..."
	@rm -f $(BINARY) *.bin *.txt coverage.out coverage.html *.puml *.html
	@echo "âœ… Clean complete"

help:
	@echo "ðŸš€ Available commands:"
	@echo ""
	@echo "ðŸ“¦ Build & Run:"
	@echo "  make build      	- Build the project"
	@echo "  make run        	- Build and run the project"
	@echo "  make all        	- Build the project (alias for build)"
	@echo ""
	@echo "ðŸ§ª Testing:"
	@echo "  make test       	- Run all tests"
	@echo "  make coverage   	- Generate HTML coverage report"
	@echo "  make bench      	- Run benchmarks"
	@echo ""
	@echo "ðŸ”§ Code Quality:"
	@echo "  make lint       	- Run go vet and format checking"
	@echo "  make lint-fix   	- Fix formatting issues"
	@echo ""
	@echo "ðŸ“Š Documentation:"
	@echo "  make uml        	- Generate UML diagrams and open in browser"
	@echo "  make uml-standalone 	- Generate UML diagrams only"
	@echo ""
	@echo "ðŸ§¹ Cleanup:"
	@echo "  make clean      	- Remove built files and reports"
	@echo ""
	@echo "ðŸ“‹ Project Info:"
	@echo "  make help       	- Show this help message"

.PHONY: all build run test coverage bench lint lint-fix uml uml-standalone clean help
